# This file was auto-generated by the Firebase CLI
# https://github.com/firebase/firebase-tools

name: Deploy to Firebase Hosting on merge
'on':
  push:
    branches:
      - main

jobs:
  build_and_deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      # Generate apiKeys.json file from secrets
      - name: Create apiKeys.json file
        run: |
          # Create directory if it doesn't exist
          mkdir -p src
          
          # Create apiKeys.json with Firebase configuration
          echo '{
            "firebaseKeys": {
              "apiKey": "${{ secrets.FIREBASE_API_KEY }}",
              "authDomain": "bakin-with-the-bros.firebaseapp.com",
              "projectId": "bakin-with-the-bros",
              "storageBucket": "bakin-with-the-bros.appspot.com",
              "messagingSenderId": "${{ secrets.FIREBASE_MESSAGING_SENDER_ID || '773535482110' }}",
              "appId": "${{ secrets.FIREBASE_APP_ID || '1:773535482110:web:0d80f8c27d0513aa1f65af' }}",
              "measurementId": "${{ secrets.FIREBASE_MEASUREMENT_ID || 'G-MMBMHSBPJ7' }}",
              "databaseURL": "https://bakin-with-the-bros-default-rtdb.firebaseio.com"
            }
          }' > src/apiKeys.json
          
          # Confirm file creation (without revealing secrets)
          echo "apiKeys.json created successfully"
      
      # Original build steps
      - run: npm ci && npm run build
      
      # Original Firebase deployment
      - uses: FirebaseExtended/action-hosting-deploy@v0
        with:
          repoToken: '${{ secrets.GITHUB_TOKEN }}'
          firebaseServiceAccount: '${{ secrets.FIREBASE_SERVICE_ACCOUNT_BAKIN_WITH_THE_BROS }}'
          channelId: live
          projectId: bakin-with-the-bros